
<!DOCTYPE html>
<html lang="en_us">
    <head>
                <title>Systems Tested</title>
            <meta charset="utf-8" />
            <meta name="generator" content="Pelican" />
            <meta name="viewport" content="width=device-width, initial-scale=1.0" />
            <link rel="stylesheet" href="/static/css/main.css" />
            <link rel="stylesheet" href="/static/css/theme.css" />
                    <link rel="icon" href="/images/patrick_head_silhouette.svg" type="image/svg+xml" />
                    <link rel="apple-touch-icon" href="/images/patrick_head_silhouette.svg" type="image/svg+xml" />
<script src="/static/misc.js"></script>


    


        <meta name="tags" content="electronics, reverse-engineering, programming" />
    <meta property="og:site_name" content="dragoncoder047&rsquo;s blog" />
    <meta property="og:title" content="Systems Tested" />
    <meta property="og:description" content="Over winter break I was able to get some more progress done building circuits to get closer to an upgrade of my old, broken Roboraptor. There are a zillion different components to this project, and I wanted to test each separately to make sure they work before I make a …" />
    <meta property="og:image" content="/images/patrick.svg" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://dragoncoder047.github.io/blog/tested_systems.html" />
    <meta property="og:locale" content="['']" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="dragoncoder047&rsquo;s blog - Systems Tested" />
    <meta name="twitter:description" content="Over winter break I was able to get some more progress done building circuits to get closer to an upgrade of my old, broken Roboraptor. There are a zillion different components to this project, and I wanted to test each separately to make sure they work before I make a …" />
    <meta name="twitter:image" content="/images/patrick.svg" />
            <!-- PrismJS -->
<script src="/static/prism.js" data-autoloader-path="https://cdn.jsdelivr.net/npm/prismjs@v1.x/components/"></script>
<script src="/static/prism-runbutton.js"></script>
<script src="/phoo/prism-phoo.js"></script>        <!-- /PrismJS -->

    </head>

    <body class="match-braces rainbow-braces">
        <header>
                <a href="https://dragoncoder047.github.io/blog"><div class="flex-row"><img src="/images/patrick.svg" width="141" alt="Patrick the purple dragon" height="85" /><div id="sitename-text" class="flex-column"><h1>dragoncoder047&rsquo;s blog</h1><h2>random thoughts about nonrandom things</h2></div></div></a>
            <nav>
                <ul>
                    <li><a href="https://dragoncoder047.github.io/blog/">Home</a></li>
                        <li><a href="https://dragoncoder047.github.io/blog/archives.html">Archives</a>
                        </li>
                        <li><a href="/">Site root</a>
                        </li>
                        <li><a href="#">Projects</a>
                                <ul>
                                                            <li><a href="https://dragoncoder047.github.io/thuepaste">Thuepaste</a>
                        </li>
                        <li><a href="https://dragoncoder047.github.io/armdroid">Armdroid</a>
                        </li>
                        <li><a href="https://dragoncoder047.github.io/langton-music">Langton's Ant Music</a>
                        </li>
                        <li><a href="https://dragoncoder047.github.io/schemascii">Schemascii</a>
                        </li>
                        <li><a href="https://dragoncoder047.github.io/parasite">Parasite</a>
                        </li>

                                </ul>
                        </li>
                    <li>
                        <form action="https://www.google.com/search" method="GET">
                            <input name="q" type="search" placeholder="Search"></input>
                            <input type="hidden" name="as_sitesearch" value="https://dragoncoder047.github.io/blog"></input>
                            <input type="submit" value="Search"></input>
                        </form>
                    </li>
                </ul>
            </nav>
        </header>
        <main>
    <h1><a href="https://dragoncoder047.github.io/blog/tested_systems.html" rel="bookmark" title="Permalink to this page">Systems Tested</a></h1>
    
    <div class="flex-row">
            <span style="flex: 1">&larr; Previous:
                <a href="https://dragoncoder047.github.io/blog/phoo_debugger.html">
                    Debugger, Almost
                </a>
            </span>
            <span>Next:
                <a href="https://dragoncoder047.github.io/blog/lilduino.html">
                    LILduino
                </a> &rarr;
            </span>
    </div>
    <div class="post-info">
        Posted <time class="published" datetime="2022-12-30T00:00:00-05:00">Fri 30 December 2022</time>
            <address>By
                    <a href="https://dragoncoder047.github.io/blog/">dragoncoder047</a>
            </address>
            <div class="tags">
                Tags:
                    <a href="https://dragoncoder047.github.io/blog/tag/electronics.html">electronics</a>
                    <a href="https://dragoncoder047.github.io/blog/tag/reverse-engineering.html">reverse-engineering</a>
                    <a href="https://dragoncoder047.github.io/blog/tag/programming.html">programming</a>
            </div>
    </div>
        <p><em>This post is part 2 of the roboraptor-upgrade series:</em></p>
        <ol class="series">
                <li >
                    <a href='https://dragoncoder047.github.io/blog/a_change.html'>Shifting Gears</a>
                </li>
                <li class="active">
                    <a href='https://dragoncoder047.github.io/blog/tested_systems.html'>Systems Tested</a>
                </li>
                <li >
                    <a href='https://dragoncoder047.github.io/blog/hairy_circuits.html'>Hairy Circuit Layout Issues</a>
                </li>
                <li >
                    <a href='https://dragoncoder047.github.io/blog/i_got_something.html'>Well, I Got Something...</a>
                </li>
                <li >
                    <a href='https://dragoncoder047.github.io/blog/boost_converter.html'>A Boost Converter</a>
                </li>
                <li >
                    <a href='https://dragoncoder047.github.io/blog/out_of_memory.html'>Error: out of memory</a>
                </li>
        </ol>
    <p>Over winter break I was able to get some more progress done building circuits to get closer to an upgrade of my old, broken Roboraptor. There are a zillion different components to this project, and I wanted to test each separately to make sure they work before I make a final board so I don&rsquo;t waste any effort or money.</p>
<p>What I&rsquo;ve managed to do so far is less than half of what I need to do to get this whole thing where I want it in the end, but at least it&rsquo;s more than I expected I would be able to do in only a week.</p>
<p>The Roboraptor&rsquo;s internal circuit board is nicely labelled on the silkscreen, and so after a bit of poking around in the head to find which power rail the other components connected to I was able to interface my ESP32 into all of the sensors around my Roboraptor pretty easily as if they were just bare components.</p>
<h2 id="infrared-system">Infrared system</h2>
<p>The original Roboraptor came with an infrared remote and a crude object-detection system, also using infrared. If I was going to be able to use the original remote with my upgraded Roboraptor, I would have to figure out how to decode that protocol.</p>
<p>David Conran wrote a <a href="https://github.com/crankyoldgit/IRremoteESP8266">nice IR encoding/decoding protocol library</a>, and I immediately tried it out. Unfortunately, the protocol registered as <code>UNKNOWN</code>, so I couldn&rsquo;t re-transmit any of the codes, save for sending the raw timing capture array, which should have worked except I wired up the IR LED&rsquo;s wrong.</p>
<p>After a <a href="https://github.com/crankyoldgit/IRremoteESP8266/issues/1938">discussion</a> with David, he <a href="https://github.com/crankyoldgit/IRremoteESP8266/pull/1939">added support</a> for the Roboraptor&rsquo;s protocol based on my raw capture arrays. After some rewiring I was successfully able to receive the remote&rsquo;s codes, and then re-transmit them and fool the Roboraptor&rsquo;s circuit board into thinking I had pressed a button on the remote. I was giddy with excitement after that worked so spectacularly. The codes I captured I saved in a <a href="https://github.com/crankyoldgit/IRremoteESP8266/issues/1938#issuecomment-1367968228">table in that issue</a> for future reference.</p>
<h2 id="audio-output">Audio output</h2>
<p>The original Roboraptor used a specialized blob-of-epoxy sound IC and a one-transistor amplifier to play the sound effects. It was pretty crappy audio quality and I knew I could do better. I bought a MAX98357A amplifier from Sparkfun earlier and procrastinated testing it, but when I finally got around to it yesterday, it worked like a charm &ndash; until I realized that I wasn&rsquo;t going to be able to wire it like it is supposed to.</p>
<p>The MAX98357A is a double-ended amplifier which uses two half-H bridges to alternately pull the speaker pins high and low, creating the alternating audio signal. Unfortunately, one end of the Roboraptor&rsquo;s speaker is permanently wired to the power supply rail, making it single-ended. I didn&rsquo;t want to cause a short circuit when the amplifier tries to pull that pin low, but I also didn&rsquo;t want to fuss around with re-wiring the head any more than I am already going to need to, so I got creative.</p>
<p>Having built a few audio amplifier circuits using the single-ended LM386 in the past, I tried a similar arrangement to those. I connected one end of the speaker to the supply rail like it would be, and the other end, through a large capacitor, to the positive output of the MAX98357A. Unfortunately, this severely reduced the output volume. I might not need the capacitor, but then I fear the audio quality would go down because the resulting setup would be eerily similar to the awful one-transistor amplifier in the original Roboraptor. I&rsquo;ll fiddle with it and get something to work.</p>
<h2 id="microphones">Microphones</h2>
<p>The Roboraptor had two small electret microphones positioned in the &ldquo;ears&rdquo;, and these fed into a simple peak-detector circuit that was really only good for detecting claps and other loud, sharp noises. Instead of limiting myself in hardware, I decided I would just connect the audio signal directly to my ESP32 and let it handle the feature detection in software.</p>
<p>Electret microphones require a preamplifier, so I Googled around for preamplifiers and found <a href="https://www.instructables.com/Electret-Mic-Preamp/">this instructable</a>, and luckily I had most of the parts on-hand. I built it with a fixed gain of 100, instead of the variable resistor to adjust the gain, used a 1000pF coupling capacitor instead of 0.1&micro;F, and omitted the low-pass filters for testing purposes. But overall, it appeared to work decently. I printed the result to the Arduino serial plotter (turning it into an oscilloscope) and I was clearly seeing a periodic audio wave in the monitor above the noise floor when I whistled into the microphone.</p>
<p>Using a standalone electret microphone I saved out of a broken intercom system produced a lot better results that the Roboraptor&rsquo;s internal microphones, but at least the result was noticeable above the noise. Maybe some low-pass filtering would smooth the noise out. I&rsquo;ll have to fiddle with it &ndash; as with everything else &ndash; until it works.</p>
<p>That&rsquo;s all, folks. I wish I could get more done, but there aren&rsquo;t enough hours in the day for that kind of work. See you in 2023.</p>
        <hr />
        <p><strong>Related Posts</strong></p>
        <ul>
                <li><a href="https://dragoncoder047.github.io/blog/feedback360_gripes.html">Two Down, A Zillion More To Go</a></li>
                <li><a href="https://dragoncoder047.github.io/blog/out_of_memory.html">Error: out of memory</a></li>
                <li><a href="https://dragoncoder047.github.io/blog/schemascii_is_done.html">Schemascii &pm; 0</a></li>
                <li><a href="https://dragoncoder047.github.io/blog/schemascii_progress.html">Schemascii &pm; 1</a></li>
                <li><a href="https://dragoncoder047.github.io/blog/feedback360.html">Reverse-Engineering the Feedback 360</a></li>
        </ul>
    <script src="https://giscus.app/client.js"
        data-repo="dragoncoder047/blog"
        data-repo-id="R_kgDOHCL60w"
        data-category="Post Comments"
        data-category-id="DIC_kwDOHCL6084CRxCW"
        data-mapping="og:title"
        data-reactions-enabled="1"
        data-input-position="top"
        data-theme="dark"
        data-lang="en"
        crossorigin="anonymous"
        async
    ></script>
            <section id="extras">
                    <div class="blogroll">
                        <ul>
                                <li><a href="https://www.conwaylife.com/">Conwaylife</a></li>
                                <li><a href="https://www.python.org/">Python</a></li>
                        </ul>
                    </div>
                    <div class="social">
                        <ul>

                                <li><a href="https://github.com/dragoncoder047">dragoncoder047 on GitHub</a></li>
                        </ul>
                    </div>
            </section>
        </main>
        <footer>
            <address>
                    Site built by <a href="https://getpelican.com/">Pelican</a>
            </address>
            <a href="#" onclick="window.scrollTo({top: 0, left: 0});">Back to top</a>
        </footer>
    </body>
</html>